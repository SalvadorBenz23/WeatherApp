# WeatherApp

## ğŸŒ Overview
**WeatherApp** is a Python-based application that **fetches a 3-day weather forecast** for Berlin and **sends it via email**  using **AW SES** every day at **8:00 AM**. It includes an **AI-powered recommendation** for after-work activities based on the weather forecast.

---

## ğŸš€ Features
âœ… Fetches **3-day weather forecasts** from the **OpenWeatherMap API**  
âœ… Includes **GPT-powered** after-work **recommendations** using **OpenAI**  
âœ… Sends **formatted weather reports** as an **HTML email**  
âœ… Runs **automatically via cron** every morning at **8:00 AM**  
âœ… **Disables itself after 14 days** to avoid infinite scheduling  

---

## ğŸ“§ Sample Email
Below is an example of the email sent by the WeatherApp:

![Sample Email](img/image.png)

---

## ğŸ“ Folder Structure
```
WeatherApp/
â”œâ”€â”€ main.py                  # Main entry point of the application
â”œâ”€â”€ weather_forecast.py      # WeatherForecast class (fetches weather data)
â”œâ”€â”€ gpt_recommendation.py    # GPTRecommendation class (AI-powered suggestions)
â”œâ”€â”€ email_notifier.py        # EmailNotifier class (handles email sending)
â”œâ”€â”€ utils.py                 # Utility functions (e.g., weather icons)
â”œâ”€â”€ config.py                # Configuration file (retrives API keys & settings from env var)
â”œâ”€â”€ disable_cron.sh          # Script to remove the cron job after 14 days
â”œâ”€â”€ cron.txt                 # Documentation for cron job setup
â”œâ”€â”€ logs/                    # Stores logs for debugging & monitoring
â”‚   â”œâ”€â”€ cron.log             # Logs from the cron job execution
â”‚   â””â”€â”€ cron_removal.log     # Logs from cron job removal
â”œâ”€â”€ requirements.txt         # Python dependencies
â””â”€â”€ README.md                # Project documentation
```

---

## ğŸ› ï¸ Setup and Installation

### 1ï¸âƒ£ Clone the Repository
```bash
git clone https://github.com/SalvadorBenz23/weatherapp.git
cd weatherapp
```

### 2ï¸âƒ£ Install Dependencies
```bash
pip install -r requirements.txt
```

### 3ï¸âƒ£ Configure Environment Variables
To set up your environment variables, run the following commands:
```bash
export OPENWEATHER_API_KEY="your_openweathermap_api_key"
export OPENAI_API_KEY="your_openai_api_key"
export SENDER_EMAIL="your_email@example.com"
export RECEIVER_EMAIL="recipient_email@example.com"
export AWS_SES_USER="your_ses_user"
export AWS_SES_PASS="your_ses_password"
export SMTP_SERVER="email-smtp.eu-west-3.amazonaws.com"
export SMTP_PORT=587
```

### 4ï¸âƒ£ Set Up Cron Jobs
#### Add a Cron Job
1. Open the crontab editor:
   ```bash
   crontab -e
   ```
2. Add the following line to schedule the job at 8 AM daily:
   ```
   0 8 * * * /usr/bin/python3 /path/to/WeatherApp/main.py >> /path/to/WeatherApp/logs/cron.log 2>&1
   ```

#### Schedule Automatic Removal
Schedule the `disable_cron.sh` script to run after 14 days using `at` or another cron job:
```bash
echo "/path/to/WeatherApp/disable_cron.sh" | at 08:01 AM `date -d "14 days" '+%Y-%m-%d'`
```

---

## ğŸ“Œ Usage
1. Ensure all dependencies are installed and all the env vars are properly set for `config.py`.
2. Run the application manually to test:
   ```bash
   python3 main.py
   ```
3. Confirm that the weather report email is received successfully.

---

## âš™ï¸ Development

### ğŸ›  Adding Features
- Add new functionalities by creating additional classes or modules.
- Follow the folder structure for modular code organization.

### âœ… Testing
- Ensure unit tests are written for each class and helper function.
- Use `pytest` for running tests.

### ğŸ” Observability
- Log all critical events, such as API errors and email failures, to `logs/cron.log`.
- Monitor the applicationâ€™s behavior using these logs.

---

## ğŸ¤ Contributing
1. Fork the repository.
2. Create a new feature branch.
3. Commit your changes and push them to your fork.
4. Submit a pull request.

---

## ğŸ“œ License

For any questions or feedback, please contact **Salvador Benites** at **s.benites@***.fr**.
